<!DOCTYPE html>
<html lang="en">

<head>
	<title>Milky Way Medium - Register</title>
	
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	
	<!-- Base stylesheet for all pages -->
	<link rel="stylesheet" type="text/css" href="../components/stylesheets/index.css" />
	
	<!-- Site logo browser icon (.ico) -->
	<link rel="icon" href="../components/images/favicon.ico">
	
</head>



<body>
	<!-- Navigation bar -->
	<div class="navBar">
	
		<!-- Left portion of navigation (logo and site title) -->
		<a href="../">
			<img src="../components/images/animated.gif">
			<div class="navBarInnerLeft"><div id="small">MILKY<span style="letter-spacing: 1px;"> </span>WAY<br></div>MEDIUM</div>
		</a>
		
		<!-- Right portion of navigation (page links) -->
		<div class="navBarInnerRight">
			<a id="logout" href=".">LOGOUT</a>
			<a id="login" href="../login/">LOGIN</a>
			<a id="register" style="opacity: 0.4" href="../register">CREATE &nbsp;ACCOUNT</a>
			<a href="../about/">ABOUT</a>
		</div>
		
	</div>
	<br><br><br><br><br><br>
	
	
	<!-- Block feed -->
	<div class="container" id="container">
		<div id="blockContent" class="block-content">
		
			<h2 class="title">CREATE A NEW ACCOUNT</h2>
			<br>
			
			<form id="register-form">

				<!-- Email address section -->
				<label id="label-email" for="email"><b>Email Address</b></label>
				<br>
				<span id="caption-email" class="caption">Please enter a valid email address...</span>
				
				<div id="box1">
					<input type="text" placeholder="Example: Scooter@gmail.com" id="email" name="email" required>
				</div>
				<br>
				
				<!-- Username section -->
				<label id="label-username" for="username"><b>Username</b></label>
				<br>
				<span id="caption-username" class="caption">Please enter a unique username...</span>
				
				<div id="box2">
					<input type="text" placeholder="Example: Scooter" id="username" name="username" required>
				</div>
				<br>
				
				<!-- Continue creating a new account button -->
				<span id="button1">
					<button id="continueButton" class="button-login" style="width: 100%; height: 55px;" type="button">CONTINUE</button>
				</span>
				<br>
				
			</form>
			
			<script type="module">
				  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js'
				  // Add Firebase products that you want to use
				  import { initializeAuth, createUserWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/9.6.7/firebase-auth.js'
				  
				  const firebaseConfig = {
				  apiKey: "AIzaSyB4L71q-5qsAD2RbzYkPI8S66t1-gPmLlc",
				  authDomain: "milkywaymedium.firebaseapp.com",
				  databaseURL: "https://milkywaymedium.firebaseio.com",
				  projectId: "milkywaymedium",
				  storageBucket: "milkywaymedium.appspot.com",
				  messagingSenderId: "165659589186",
				  appId: "1:165659589186:web:14f35c3010b2e5600c0bdb",
				  measurementId: "G-WGKXQT89RQ"
				};

				// Initialize Firebase
				const app = initializeApp(firebaseConfig);
				const auth = initializeAuth(app);

				console.log(app, auth);
				
				
				
				const registerForm = document.querySelector('#register-form');
				const continueButton = document.getElementById("continueButton");
				var email = "";
				var username ="";
				var alphaNumeric = /^([0-9]|[a-z])+([0-9a-z]+)$/i;
				
				function passCreds() {
						console.log("Passing credentials...");
						email = document.getElementById("email").value;
						username = document.getElementById("username").value;
							
						if (email != "" &&
							email.includes("@") &&
							email.includes(".") &&
							email.length > 5 &&
							!email.includes(" ") &&
							username != "" &&
							username.length > 2 &&
							username.match(alphaNumeric)) {
								
								console.log("Requirements met...");
								
								const labelEmail = document.getElementById("label-email");
								const labelUsername = document.getElementById("label-username");
								const captionEmail = document.getElementById("caption-email");
								const captionUsername = document.getElementById("caption-username");
								const box1 = document.getElementById("box1");
								const box2 = document.getElementById("box2");
								const button1 = document.getElementById("button1");
								
								labelEmail.innerHTML = "<b>Password</b>";
								labelUsername.innerHTML = "<b>Confirm Password</b>";
								captionEmail.innerHTML = "Please enter a password that includes a number or symbol with at least eight characters...";
								captionUsername.innerHTML = "Please retype your password to confirm it is correct...";
								box1.innerHTML = `<input type="password" placeholder="Example: Andr0meda" id="password" name="password" required>`;
								box2.innerHTML = `<input type="password" placeholder="Example: Andromed@" id="confirmPassword" name="confirmPassword" required>`;
								button1.innerHTML = `<button class="button-login" style="width: 100%; height: 55px;" type="submit">COMPLETE REGISTRATION</button>`;
								console.log("Credentials passed...");
						}
						
						else {
							console.log("Your credentials do not meet the standards.");
							email = "";
							username ="";
						}
					}
					
					continueButton.addEventListener('click', (e) => {
						passCreds();
					});

					registerForm.addEventListener('submit', (e) => {
						// Create account
						e.preventDefault();
						var password = registerForm['password'].value;
						var confirmPassword = registerForm['confirmPassword'].value;
						
						if(password == confirmPassword &&
						   password.length) {
						
							createUserWithEmailAndPassword(auth, email, password)
							  .then((userCredential) => {
								// Signed in 
								const user = userCredential.user;
								const blockContent = document.getElementById("blockContent");
								blockContent.innerHTML =
								`<h2 class="title">WELCOME</h2>
								<br>
								<h4 class="text" style="text-align: center;">Congratulations, ` + username + `!<br>Your account was created successfully.</h4>
								`
							  })
							  .catch((error) => {
								const errorCode = error.code;
								const errorMessage = error.message;
								// ..
							  });
						  
						 }
						 else {
							password = "";
							confirmPassword = "";
						 }
					});
					
					const logout = document.getElementById("logout");
					logout.addEventListener('click', (e) => {
						e.preventDefault();
						signOut(auth).then(() => {
							console.log('Signed out.');
						});
					})
			</script>
			
		</div>
	</div>
	
	
</body>

</html>


